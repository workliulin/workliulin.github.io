<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>é“¾æ¥ç”Ÿæˆå™¨</title>

    <script>
        let prefixConfig = {};

        window.onload = function () {
            fetch("https://linlinread.oss-cn-beijing.aliyuncs.com/www_files/prefix.json")
                .then(response => response.json())
                .then(data => {
                    prefixConfig = data;

                    // è®¾ç½®é»˜è®¤å€¼ï¼šå®¢æœç”¨æˆ·åï¼ˆå¦‚ comapsï¼‰
                    if (data.taobaoid) {
                        document.getElementById("inputString").value = data.taobaoid;
                    }

                    // è®¾ç½®é»˜è®¤å€¼ï¼šè‰æ–™è·³è½¬é“¾æ¥
                    if (data.caoliao) {
                        document.getElementById("rawRedirectInput").value = data.caoliao;
                    }
					if (data.caoliao) {
						document.getElementById("caoliaoLink").textContent = data.caoliao;
						} else {
							document.getElementById("caoliaoLink").textContent = "None";
								}

					if (data.youma) {
						document.getElementById("youmaLink").textContent = data.youma;
						} else {
							document.getElementById("youmaLink").textContent = "None";
								}
                    if (data.jiema) {
						document.getElementById("jiemaLink").textContent = data.jiema;
						} else {
							document.getElementById("jiemaLink").textContent = "None";
								}
                })
                .catch(error => {
                    console.error("é…ç½®åŠ è½½å¤±è´¥ï¼š", error);
                    alert("âš ï¸ æ— æ³•åŠ è½½å‰ç¼€é…ç½®ï¼Œæ£€æŸ¥æ–‡ä»¶æˆ–ACLæƒé™");
                });
        };

        function encodeToBase64(inputString) {
            return btoa(unescape(encodeURIComponent(inputString)));
        }

        function replaceTrailingEqualsWithEncoded(url) {
            const match = url.match(/=+$/);
            if (match) {
                const equalSigns = match[0];
                const encodedEquals = "%3d".repeat(equalSigns.length);
                const replacedUrl = url.replace(/=+$/, encodedEquals);
                const notice = `ï¼ˆå·²å°†ç»“å°¾çš„ ${equalSigns} æ›¿æ¢ä¸º %3dï¼‰`;
                return { url: replacedUrl, notice: notice };
            }
            return { url: url, notice: "" };
        }

        function generate() {
            const userInput = document.getElementById("inputString").value;
            const encodedString = encodeToBase64(userInput);

            if (!prefixConfig.url1 || !prefixConfig.url2) {
                alert("âš ï¸ å‰ç¼€å°šæœªåŠ è½½");
                return;
            }

            // å•†å®¶1
            let { url: resultUrl1, notice: notice1 } = replaceTrailingEqualsWithEncoded(
                prefixConfig.url1 + encodedString
            );
            document.getElementById("result1").innerHTML = `<strong>ä¸ªäºº/å•†å®¶1ï¼š</strong><span class="url">${resultUrl1}</span> ${notice1}`;

            // å•†å®¶2
            const resultUrl3 = prefixConfig.url1 + encodedString + (prefixConfig.url3_extra || "");
            document.getElementById("result3").innerHTML = `<strong>ä¸ªäºº/å•†å®¶2ï¼š</strong><span class="url">${resultUrl3}</span>`;

            // å•†å®¶3
            let { url: resultUrl2, notice: notice2 } = replaceTrailingEqualsWithEncoded(
                prefixConfig.url2 + encodedString
            );
            document.getElementById("result2").innerHTML = `<strong>å•†å®¶3ï¼š</strong><span class="url">${resultUrl2}</span> ${notice2}`;
        }

        function generateRedirectUrl() {
            const rawUrl = document.getElementById("rawRedirectInput").value;
            if (!prefixConfig.redirectPrefix) {
                alert("âš ï¸ å‰ç¼€å°šæœªåŠ è½½");
                return;
            }
            const encodedUrl = encodeURIComponent(rawUrl);
            const finalUrl = prefixConfig.redirectPrefix + encodedUrl;
            document.getElementById("redirectResult").innerHTML = `<strong>è·³è½¬é“¾æ¥ï¼š</strong><span class="url">${finalUrl}</span>`;
        }

        function copyResult(resultId, noticeId) {
            const url = document.querySelector(`#${resultId} .url`).textContent;
            copyToClipboard(url);

            const noticeElem = document.getElementById(noticeId);
            noticeElem.textContent = "âœ… å·²å¤åˆ¶URL";
            setTimeout(() => {
                noticeElem.textContent = "";
            }, 2000);
        }

        function copyToClipboard(text) {
            const tempInput = document.createElement("textarea");
            tempInput.value = text;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand("copy");
            document.body.removeChild(tempInput);
        }
    </script>
</head>
<body>
    <h2>å®¢æœ</h2>
    <p>ä¼˜å…ˆä½¿ç”¨<strong>ä¸ªäºº/å•†å®¶2</strong>ï¼›å…¶ä»–ä¸¤ä¸ªç½‘å€ç»“å°¾å¦‚æœæ˜¯ "=" æ›¿æ¢ä¸º "%3d"ï¼Œå¦åˆ™å®‰å“ä¸è¯†åˆ«</p>
    <p>è½¬ä¸ªäººï¼šç”¨æˆ·åæœ€å¥½æ˜¯é»˜è®¤çš„ tb012345ï¼›ç”µè„‘æ—ºæ—ºè®¾ç½®æ¥æ”¶é™Œç”Ÿäººæ¶ˆæ¯ + ä¸ç”¨éªŒè¯å°±èƒ½åŠ æˆ‘å¥½å‹</p>

    <input type="text" id="inputString" placeholder="ç”¨æˆ·å" />
    <button onclick="generate()">ç”Ÿæˆå®¢æœURL</button>

    <p id="result1"></p>
    <button class="copy-btn" onclick="copyResult('result1', 'copyNotice1')">ğŸ“‹ å¤åˆ¶ä¸ªäºº/å•†å®¶1</button>
    <span id="copyNotice1" class="copy-notice"></span>

    <p id="result3"></p>
    <button class="copy-btn" onclick="copyResult('result3', 'copyNotice3')">ğŸ“‹ å¤åˆ¶ä¸ªäºº/å•†å®¶2</button>
    <span id="copyNotice3" class="copy-notice"></span>

    <p id="result2"></p>
    <button class="copy-btn" onclick="copyResult('result2', 'copyNotice2')">ğŸ“‹ å¤åˆ¶å•†å®¶3</button>
    <span id="copyNotice2" class="copy-notice"></span>

    <hr />

    <h2>è·³è½¬</h2>
	<p>
    è‰æ–™ <span id="caoliaoLink">None</span><br>
    ä¼˜ç  <span id="youmaLink">None</span><br>
    <a href="./land.html">Land Page</a>
	</p>
    <input type="text" id="rawRedirectInput" placeholder="è·³è½¬é“¾æ¥" />
    <br /><br />
    <button onclick="generateRedirectUrl()">ç”Ÿæˆè·³è½¬é“¾æ¥</button>
    <p id="redirectResult"></p>
    <button class="copy-btn" onclick="copyResult('redirectResult', 'copyNoticeRedirect')">ğŸ“‹ å¤åˆ¶è·³è½¬é“¾æ¥</button>
    <span id="copyNoticeRedirect" class="copy-notice"></span>

    <p>â‘  åˆ›å»ºè‰æ–™äºŒç»´ç  <br>â‘¡ è§£ç è·å–ç½‘å€ <span id="jiemaLink">None</span> <br>â‘¢ ç½‘é¡µF12è·å–å°ç¨‹åºé“¾æ¥</p>
    <img src="https://linlinread.oss-cn-beijing.aliyuncs.com/www_files/get_weixin.jpg" width="50%" height="50%" />
</body>
</html>
